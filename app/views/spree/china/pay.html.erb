<meta content="width=device-width, initial-scale=1.0, maximum-scale=1" name="viewport">
<% self.title = "Pay" %>
<% @body_id = 'Pay' %>
<%= render partial: 'spree/shared/error_messages', locals: { target: @order } %>

<% if false %>
<div id="china-pay">
  <div v-if="!paid">
    <div class="item">
      <div class="item-image">
        <%= image_tag("china/package.png")%>
      </div>
      <div class="item-details">
        <div class="fun">美容养颜 美容养颜 美容养颜 <br>6g/包</div>
        <div class="qty">x1</div>
        <div class="price">$39.99</div>
        <div class="total">$39.99</div>
      </div>
    </div>
    <div class="delivery">
      <div class="left">配送方式</div>
      <div class="right">美国直邮</div>
    </div>
    <div class="delivery">
      <div class="left">邮费</div>
      <div class="right">$5.00</div>
    </div>
    <div class="delivery">
      <div class="left">总计</div>
      <div class="right">$44.99</div>
    </div>
    <div class="plane">
      <div class="line"></div>
      <%= image_tag("china/icon-plane@2x.png") %>
      <div class="line"></div>
    </div>
    <p style="margin: 0 20px">订单确认后，美国加利福尼亚Cool Choice总部在48小时之内完成定制并发货，经国际物流（空运）及清关后送到您手中，时间约20天左右。</p>
    <div></div>
    <div class="next-step">
      <div class="total">总计： $44.99</div>
      <div class="pay-button" data-hook="buttons" @click="this.paid = true"><%= submit_tag '去支付' %></div>
    </div>
  </div>
  <div class="then" v-if="paid">
    <%= image_tag("china/clock.png")%><br>
    订单确认中……请耐心等待
  </div>
</div>
<% end %>

<div class="summary-table" style="width:100%">
  <%= render partial: 'summary', locals: { order: @order } %>
</div>

  <div class="container" >
    <%= form_for @order, url: china_complete_path, html: { }  do |form| %>
      <input name="id" value="<%= @order.id %>" hidden="hidden" />
      <div class="" id="payment" data-hook>

        <ul class="list-group" id="payment-method-fields" style="display: none" data-hook>
          <% @order.available_payment_methods.each do |method| %>
          <% if method.method_type == 'stripe' %>
            <li class="list-group-item">
              <label>
                <%= radio_button_tag "order[payments_attributes][][payment_method_id]", method.id, method == @order.available_payment_methods.first %>
                <%= Spree.t(method.name, :scope => :payment_methods, :default => method.name) %>
              </label>
            </li>
            <% end %>
            <% end %>
        </ul>

          <ul class="nav" id="payment-methods" data-hook>
            <% @order.available_payment_methods.each do |method| %>
            <% if method.method_type == 'stripe' %>
              <li id="payment_method_<%= method.id %>" class="<%= 'last' if method == @order.available_payment_methods.last %>" data-hook>
                <fieldset>
                  <%= render :partial => "stripe", :locals => { :payment_method => method } %>
                </fieldset>
              </li>
              <% end %>
            <% end %>
          </ul>
      </div>
    <div class="" data-hook="buttons">
      <%= submit_tag Spree.t(:save_and_continue), :class => 'button', :style => "display: none;"  %>
    </div>
<% end %>
</div>

<script>
  Spree.current_order_id = "<%= @order.number %>"
  Spree.current_order_token = "<%= @order.guest_token %>"
  new Vue({
    el: "#china-pay",
    data: {
      paid: false
    }
  })
</script>
